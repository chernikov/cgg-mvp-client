# AI Logs System Documentation

## –û–ø–∏—Å —Å–∏—Å—Ç–µ–º–∏

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è AI –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤—Å—ñ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ OpenAI API –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç—É CGG MVP.

## –©–æ –ª–æ–≥—É—î—Ç—å—Å—è

### Input (–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ)
- `responses`: –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∞–Ω–∫–µ—Ç–∏
- `language`: –ú–æ–≤–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `prompt`: –ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç—É, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ AI

### Output (–í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ)
- `rawResponse`: –°–∏—Ä–∏–π —Ç–µ–∫—Å—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ OpenAI
- `parsedResponse`: –†–æ–∑–ø–∞—Ä—Å–µ–Ω–∞ JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—å
- `success`: –°—Ç–∞—Ç—É—Å —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—É (true/false)
- `error`: –¢–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏ (—è–∫—â–æ —î)

### Metadata (–ú–µ—Ç–∞–¥–∞–Ω—ñ)
- `questionnaireId`: –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∞–Ω–∫–µ—Ç–∏ ('magical-quest', 'student-survey', —Ç–æ—â–æ)
- `userId`: ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—è–∫—â–æ —î)
- `userAgent`: User-Agent –±—Ä–∞—É–∑–µ—Ä–∞
- `model`: –ú–æ–¥–µ–ª—å AI —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—å
- `tokensUsed`: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤
- `responseTime`: –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö

### Timestamps (–ß–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏)
- `requestStarted`: –ß–∞—Å –ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—Ç—É
- `requestCompleted`: –ß–∞—Å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—É
- `createdAt`: –ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É –≤ –±–∞–∑—ñ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ Firebase Firestore –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó `ai_logs`.

### –ü—Ä–∏–∫–ª–∞–¥ –¥–æ–∫—É–º–µ–Ω—Ç—É:
```json
{
  "input": {
    "responses": [...],
    "language": "uk",
    "prompt": "..."
  },
  "output": {
    "rawResponse": "...",
    "parsedResponse": {...},
    "success": true,
    "error": null
  },
  "metadata": {
    "questionnaireId": "magical-quest",
    "userId": "user123",
    "userAgent": "Mozilla/5.0...",
    "model": "gpt-4-turbo-preview",
    "tokensUsed": 1234,
    "responseTime": 2500
  },
  "timestamps": {
    "requestStarted": "2025-06-24T10:00:00.000Z",
    "requestCompleted": "2025-06-24T10:00:02.500Z", 
    "createdAt": "2025-06-24T10:00:03.000Z"
  }
}
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

–õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó `analyzeSurveyResponses()` –≤ `src/lib/openai.ts`.

### –†—É—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

```typescript
import aiLogsService from '@/services/ai-logs.service'

// –°—Ç–≤–æ—Ä–∏—Ç–∏ —à–∞–±–ª–æ–Ω –ª–æ–≥—É
const logTemplate = aiLogsService.createLogTemplate(
  responses,
  language, 
  prompt,
  questionnaireId,
  userId
)

// –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ AI
const completedLog = aiLogsService.completeLog(
  logTemplate,
  rawResponse,
  parsedResponse,
  success,
  error,
  tokensUsed
)

// –ó–±–µ—Ä–µ–≥—Ç–∏ –ª–æ–≥
await aiLogsService.logAIRequest(completedLog)
```

## –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

### –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–î–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/admin/ai-logs` –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏:

- –ü–µ—Ä–µ–≥–ª—è–¥ –≤—Å—ñ—Ö –ª–æ–≥—ñ–≤ –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é (50 –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤)
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞:
  - –¢–∏–ø–æ–º –∞–Ω–∫–µ—Ç–∏ (questionnaireId)
  - –°—Ç–∞—Ç—É—Å–æ–º (—É—Å–ø—ñ—à–Ω—ñ/–ø–æ–º–∏–ª–∫–∏)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  - –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª–æ–≥—ñ–≤
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å —É—Å–ø—ñ—à–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
  - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
  - –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –î–µ—Ç–∞–ª—å–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –∫–æ–∂–Ω–æ–≥–æ –ª–æ–≥—É

### –§—ñ–ª—å—Ç—Ä–∏

#### –ó–∞ —Ç–∏–ø–æ–º –∞–Ω–∫–µ—Ç–∏:
- `magical-quest`: –û—Å–Ω–æ–≤–Ω–∞ –∞–Ω–∫–µ—Ç–∞ –º–∞–≥—ñ—á–Ω–æ–≥–æ –∫–≤–µ—Å—Ç—É
- `magical-quest-try-magic`: –°–ø—Ä–æ–±–∞ –º–∞–≥—ñ—ó –ø—ñ—Å–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- `student-survey`: –ê–Ω–∫–µ—Ç–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
- `student-try-magic`: –°–ø—Ä–æ–±–∞ –º–∞–≥—ñ—ó –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤

#### –ó–∞ —Å—Ç–∞—Ç—É—Å–æ–º:
- `all`: –í—Å—ñ –∑–∞–ø–∏—Å–∏
- `success`: –¢—ñ–ª—å–∫–∏ —É—Å–ø—ñ—à–Ω—ñ –∑–∞–ø–∏—Ç–∏
- `error`: –¢—ñ–ª—å–∫–∏ –ø–æ–º–∏–ª–∫–∏

## –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ

–°–∏—Å—Ç–µ–º–∞ –≤–∏–≤–æ–¥–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
- `ü§ñ Starting AI request...` - –ø–æ—á–∞—Ç–æ–∫ –∑–∞–ø–∏—Ç—É
- `‚úÖ AI request completed successfully` - —É—Å–ø—ñ—à–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
- `‚ùå Error analyzing survey responses` - –ø–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É
- `üìù Saving AI log entry` - –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—É
- `‚úÖ AI log entry saved with ID` - —É—Å–ø—ñ—à–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

### –ü–æ–º–∏–ª–∫–∏

–Ø–∫—â–æ –∑–∞–ø–∏—Å –ª–æ–≥—É –Ω–µ –≤–¥–∞–≤—Å—è, —Å–∏—Å—Ç–µ–º–∞:
1. –í–∏–≤–æ–¥–∏—Ç—å –ø–æ–º–∏–ª–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
2. –ù–µ –±–ª–æ–∫—É—î –æ—Å–Ω–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
3. –î–æ–∑–≤–æ–ª—è—î –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ AI –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è –Ω–µ –ø—Ä–∞—Ü—é—î

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏

### Firestore Rules

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –∫–æ–ª–µ–∫—Ü—ñ—ó `ai_logs`:

```javascript
// –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –ª–æ–≥–∏
match /ai_logs/{document} {
  allow read, write: if request.auth != null && 
                     get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
}

// –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∑–∞–ø–∏—Å—É –ª–æ–≥—ñ–≤ –≤—ñ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
match /ai_logs/{document} {
  allow create: if request.auth != null;
}
```

## –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:

1. **–ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ AI** - —Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤
2. **–£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤** - –≤—ñ–¥—Å–æ—Ç–æ–∫ —É—Å–ø—ñ—à–Ω–∏—Ö vs –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤** - –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ API OpenAI
4. **–ü–æ–ø—É–ª—è—Ä–Ω—ñ –∞–Ω–∫–µ—Ç–∏** - —è–∫—ñ —Ç–∏–ø–∏ –æ–ø–∏—Ç—É–≤–∞–Ω—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ
5. **–ü–æ–º–∏–ª–∫–∏** - –∞–Ω–∞–ª—ñ–∑ —Ç–∏–ø–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

- –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ < 5 —Å–µ–∫—É–Ω–¥)
- –í—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –≤–∏—Ç—Ä–∞—Ç
- –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—ñ–≤ —Ç–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞—Ç–∏ —Å—Ç–∞—Ä—ñ –ª–æ–≥–∏ (> 6 –º—ñ—Å—è—Ü—ñ–≤) –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –º—ñ—Å—Ü—è –≤ –±–∞–∑—ñ

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–∏–ø—ñ–≤ –∞–Ω–∫–µ—Ç:

1. –û–Ω–æ–≤–∏—Ç–∏ –≤–∏–∫–ª–∏–∫ `analyzeSurveyResponses()` –∑ –Ω–æ–≤–∏–º `questionnaireId`
2. –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–∏–ø –¥–æ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –≤ `AILogsAdmin.tsx`
3. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ –ª–æ–≥—É–≤–∞–Ω–Ω—è:

1. –†–æ–∑—à–∏—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `AILogEntry` –≤ `ai-logs.service.ts`
2. –û–Ω–æ–≤–∏—Ç–∏ –º–µ—Ç–æ–¥–∏ `createLogTemplate()` —Ç–∞ `completeLog()`
3. –û–Ω–æ–≤–∏—Ç–∏ UI –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –ø–æ–∫–∞–∑—É –Ω–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
